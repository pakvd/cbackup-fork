# üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ cBackup

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é cBackup, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ —á–µ—Ä–µ–∑ Docker Compose.

## üìã –ü–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º

1. **–°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
   ```bash
   docker compose exec db mysqldump -u cbackup -pcbackup_password cbackup | gzip > backup-$(date +%Y-%m-%d).sql.gz
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é** –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ: `System -> About`

## üöÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Makefile (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

```bash
# 1. –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git pull

# 2. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
make down

# 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –Ω–∞ —Ñ–∞–π–ª—ã
make set-permissions

# 4. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
make rebuild

# 5. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –µ—Å—Ç—å)
docker compose exec web php yii migrate

# 6. –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à
docker compose exec web php yii cache/flush-all
docker compose exec web php yii asset/flush-all

# 7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
make status
```

## üìù –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker compose exec db mysqldump -u cbackup -pcbackup_password cbackup | gzip > backup-$(date +%Y-%m-%d).sql.gz

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ–∑–¥–∞–Ω–∞
ls -lh backup-*.sql.gz
```

### –®–∞–≥ 2: –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Git:
```bash
git pull
```

–ï—Å–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç–µ –≤—Ä—É—á–Ω—É—é:
```bash
# –°–∫–∞—á–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é
wget http://cbackup.me/latest?package=update -O update.tar.gz

# –†–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
tar -xzf update.tar.gz -C .

# –£–¥–∞–ª–∏—Ç—å –∞—Ä—Ö–∏–≤
rm -f update.tar.gz
```

### –®–∞–≥ 3: –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
make down
# –∏–ª–∏
docker compose down
```

### –®–∞–≥ 4: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –Ω–∞ —Ñ–∞–π–ª—ã

```bash
make set-permissions
# –∏–ª–∏
./set-permissions.sh
```

–≠—Ç–æ –≤–∞–∂–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –º–æ–≥—É—Ç –∏–º–µ—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞.

### –®–∞–≥ 5: –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
make rebuild
# –∏–ª–∏
docker compose build --no-cache
docker compose up -d
```

### –®–∞–≥ 6: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
docker compose exec web php yii migrate
```

–≠—Ç–æ –ø—Ä–∏–º–µ–Ω–∏—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å.

### –®–∞–≥ 7: –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞

```bash
docker compose exec web php yii cache/flush-all
docker compose exec web php yii asset/flush-all
```

### –®–∞–≥ 8: –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
make status
# –∏–ª–∏
docker compose ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
make logs
# –∏–ª–∏
docker compose logs -f
```

### –®–∞–≥ 9: –û—á–∏—Å—Ç–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞

**–í–∞–∂–Ω–æ**: –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞, –Ω–∞–∂–∞–≤ `CTRL+F5` (Windows/Linux) –∏–ª–∏ `CMD+SHIFT+R` (macOS).

## üîÑ –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π)

–î–ª—è –æ–ø—ã—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –æ–±–Ω–æ–≤–∏—Ç—å:

```bash
git pull && \
make down && \
make set-permissions && \
make rebuild && \
docker compose exec web php yii migrate && \
docker compose exec web php yii cache/flush-all && \
docker compose exec web php yii asset/flush-all && \
make status
```

## ‚ö†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker compose logs

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø—Ä–∞–≤–∞ –Ω–∞ —Ñ–∞–π–ª—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
make set-permissions

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–Ω–æ–≤–æ
make rebuild
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –º–∏–≥—Ä–∞—Ü–∏–π
docker compose exec web php yii migrate --interactive=0

# –ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –æ—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
docker compose exec web php yii migrate/down
```

### –ü—Ä–æ–±–ª–µ–º–∞: –°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –æ—Å—Ç–∞–ª–∏—Å—å –≤ –∫–µ—à–µ

```bash
# –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∫–µ—à–∏
docker compose exec web php yii cache/flush-all
docker compose exec web php yii asset/flush-all

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker compose restart web
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –Ω–∞ —Ñ–∞–π–ª—ã –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –∑–∞–Ω–æ–≤–æ
make set-permissions

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
make restart
```

## üîó –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **–ß–∏—Å—Ç–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞**: –°–º. `CLEAN_INSTALL.md`
- **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç**: –°–º. `QUICKSTART.md`
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞**: –°–º. `PRODUCTION_READY.md`

## üìù –ó–∞–º–µ—Ç–∫–∏

1. **–ü—Ä–∞–≤–∞ –Ω–∞ —Ñ–∞–π–ª—ã**: –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `make set-permissions` –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–∞–≤–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

2. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ**: –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º.

3. **–ú–∏–≥—Ä–∞—Ü–∏–∏**: –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ, –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –ª–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –º–µ–∂–¥—É –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏.

4. **–ö–µ—à –±—Ä–∞—É–∑–µ—Ä–∞**: –ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –æ—á–∏—â–∞—Ç—å –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –Ω–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ.

5. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏**: –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é –≤ `System -> About`, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ.

## üéØ –ß–µ–∫-–ª–∏—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

- [ ] –°–æ–∑–¥–∞–Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- [ ] –ü–æ–ª—É—á–µ–Ω—ã –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (git pull –∏–ª–∏ —Å–∫–∞—á–∞–Ω–æ –≤—Ä—É—á–Ω—É—é)
- [ ] –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (make down)
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∞ –Ω–∞ —Ñ–∞–π–ª—ã (make set-permissions)
- [ ] –ü–µ—Ä–µ—Å–æ–±—Ä–∞–Ω—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (make rebuild)
- [ ] –ü—Ä–∏–º–µ–Ω–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (yii migrate)
- [ ] –û—á–∏—â–µ–Ω –∫–µ—à (cache/flush-all, asset/flush-all)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (make status)
- [ ] –û—á–∏—â–µ–Ω –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞ (CTRL+F5)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –≤–µ—Ä—Å–∏—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ (System -> About)

## ‚ö° –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç:

```bash
#!/bin/bash
# update-cbackup.sh

set -e

echo "=== cBackup Update Script ==="

# Backup
echo "Creating database backup..."
docker compose exec db mysqldump -u cbackup -pcbackup_password cbackup | gzip > backup-$(date +%Y-%m-%d).sql.gz

# Pull updates
echo "Pulling latest changes..."
git pull

# Stop, set permissions, rebuild
echo "Stopping containers..."
make down

echo "Setting permissions..."
make set-permissions

echo "Rebuilding containers..."
make rebuild

# Apply migrations
echo "Applying database migrations..."
docker compose exec web php yii migrate

# Clear cache
echo "Clearing cache..."
docker compose exec web php yii cache/flush-all
docker compose exec web php yii asset/flush-all

# Status
echo "Checking status..."
make status

echo "=== Update Complete ==="
echo "Don't forget to clear your browser cache (CTRL+F5)!"
```

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–∞–∫ `update-cbackup.sh`, —Å–¥–µ–ª–∞–π—Ç–µ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º (`chmod +x update-cbackup.sh`) –∏ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ: `./update-cbackup.sh`

