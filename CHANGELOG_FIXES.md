# –ñ—É—Ä–Ω–∞–ª –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

## 2024-11-04 - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

### üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è PHP-FPM

**–ü—Ä–æ–±–ª–µ–º–∞:** PHP-FPM —Å–ª—É—à–∞–ª –Ω–∞ `127.0.0.1:9000`, —á—Ç–æ –Ω–µ –ø–æ–∑–≤–æ–ª—è–ª–æ Nginx –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∏–∑ –¥—Ä—É–≥–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `core/Dockerfile` - PHP-FPM –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –Ω–∞ `0.0.0.0:9000` –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –æ–±—Ä–∞–∑–∞
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `core/docker-entrypoint.sh` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç listen –∞–¥—Ä–µ—Å –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `FIX_PHPFPM_LISTEN.sh` –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –∑–∞–ø—É—â–µ–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `core/Dockerfile`
- `core/docker-entrypoint.sh`
- `FIX_PHPFPM_LISTEN.sh` (–Ω–æ–≤—ã–π)

### üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Redis –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ—Å—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–≤–æ–π—Å—Ç–≤–æ `socketTimeout` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Redis, –≤—ã–∑—ã–≤–∞–ª–æ –æ—à–∏–±–∫—É "Setting unknown property".

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ó–∞–º–µ–Ω–µ–Ω–æ `socketTimeout` –Ω–∞ `connectionTimeout` –∏ `dataTimeout` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Redis
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ñ–∞–π–ª—ã `core/config/web.php` –∏ `core/config/console.php`

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `core/config/web.php`
- `core/config/console.php`

### üîß –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Composer

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ volume mount –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `vendor` –∏–∑ –æ–±—Ä–∞–∑–∞ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–ª–∞—Å—å –ø—É—Å—Ç–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–µ–π —Å —Ö–æ—Å—Ç–∞.

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –£–ª—É—á—à–µ–Ω entrypoint —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω Makefile –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `asset-packagist.org` –≤ `composer.json` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å bower-asset –ø–∞–∫–µ—Ç–∞–º–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞ `yiisoft/yii2-composer`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ `composer.lock` —á–µ—Ä–µ–∑ `composer update`

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `core/composer.json` - –¥–æ–±–∞–≤–ª–µ–Ω —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π asset-packagist.org
- `core/docker-entrypoint.sh` - —É–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- `core/Dockerfile` - —É–¥–∞–ª–µ–Ω `--no-plugins` –¥–ª—è —Ä–∞–±–æ—Ç—ã asset-packagist
- `Makefile` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- `QUICK_FIX_COMPOSER.sh` - –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø–ª–∞–≥–∏–Ω–æ–≤
- `CLEAN_INSTALL.sh` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### üìù –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ `INSTALLATION_GUIDE.md` - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
- ‚úÖ `AUTO_INSTALL.md` - –æ–ø–∏—Å–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏
- ‚úÖ `TROUBLESHOOTING_502.md` - —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ 502
- ‚úÖ `QUICK_FIX_502.md` - –±—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 502
- ‚úÖ `INSTALL_COMPOSER_DEPS.md` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Composer
- ‚úÖ `CHECK_PHPFPM.sh` - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ PHP-FPM
- ‚úÖ `DEBUG_PHPFPM.sh` - –¥–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ PHP-FPM
- ‚úÖ `FORCE_FIX_PHPFPM.sh` - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ PHP-FPM
- ‚úÖ `FIX_PHPFPM_LISTEN.sh` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ listen –∞–¥—Ä–µ—Å–∞ PHP-FPM
- ‚úÖ `CLEAN_INSTALL.sh` - —Å–∫—Ä–∏–ø—Ç —á–∏—Å—Ç–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏
- ‚úÖ `QUICK_FIX_COMPOSER.sh` - –±—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:**
- ‚úÖ `README.md` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ
- ‚úÖ `QUICKSTART.md` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- ‚úÖ `PRODUCTION_CHECKLIST.md` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ PHP-FPM –∏ Redis

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: PHP-FPM —Å–ª—É—à–∞–µ—Ç –Ω–∞ 127.0.0.1:9000

**–†–µ—à–µ–Ω–∏–µ:** Entrypoint —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç —ç—Ç–æ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:
```bash
./FIX_PHPFPM_LISTEN.sh
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Composer –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:** 
```bash
make install-composer
# –∏–ª–∏
./QUICK_FIX_COMPOSER.sh
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ "Setting unknown property: yii\redis\Connection::socketTimeout"

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –ï—Å–ª–∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Å–Ω–æ–≤–∞:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `core/config/web.php` –∏ `core/config/console.php` –∏—Å–ø–æ–ª—å–∑—É—é—Ç `connectionTimeout` –∏ `dataTimeout`
- –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à: `docker compose exec web rm -rf /var/www/html/runtime/cache/*`

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
# 1. PHP-FPM listen –∞–¥—Ä–µ—Å
docker compose exec web grep "^listen = " /usr/local/etc/php-fpm.d/www.conf
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: listen = 0.0.0.0:9000

# 2. –ü—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ –ø–æ—Ä—Ç–∞
docker compose exec web ss -tlnp | grep 9000
# –î–æ–ª–∂–µ–Ω —Å–ª—É—à–∞—Ç—å –Ω–∞ 0.0.0.0:9000 –∏–ª–∏ *:9000

# 3. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Composer
docker compose exec web test -f /var/www/html/vendor/autoload.php && echo "OK" || echo "ERROR"

# 4. Redis –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
docker compose exec web grep -E "(connectionTimeout|dataTimeout)" /var/www/html/config/web.php
# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±–∞ —Å–≤–æ–π—Å—Ç–≤–∞

# 5. –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ—Å—Ç—É–ø–µ–Ω
curl -I http://localhost:8080
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å HTTP 200 –∏–ª–∏ 302 (—Ä–µ–¥–∏—Ä–µ–∫—Ç)
```

---

**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2024-11-04

