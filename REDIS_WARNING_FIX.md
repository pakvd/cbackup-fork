# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è Redis –æ memory overcommit

## ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:
```
WARNING Memory overcommit must be enabled! Without it, a background save or replication may fail under low memory condition.
```

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ —Ö–æ—Å—Ç–µ

`vm.overcommit_memory` - —ç—Ç–æ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä —è–¥—Ä–∞ Linux, –∫–æ—Ç–æ—Ä—ã–π **–Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å –∏–∑ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**. –ï–≥–æ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –Ω–∞ —Ö–æ—Å—Ç–µ, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω Docker.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ —Ö–æ—Å—Ç–µ:

**–í—Ä–µ–º–µ–Ω–Ω–æ (–¥–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏):**
```bash
sudo sysctl vm.overcommit_memory=1
```

**–ü–æ—Å—Ç–æ—è–Ω–Ω–æ (–ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏):**
```bash
echo "vm.overcommit_memory = 1" | sudo tee -a /etc/sysctl.conf
sudo sysctl -p
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Redis:
```bash
docker compose restart redis
docker compose logs redis | grep -i warning
```

–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∏—Å—á–µ–∑–Ω—É—Ç—å! ‚úÖ

## üîß –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã (–µ—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ö–æ—Å—Ç—É):

### 1. –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ (–º–æ–∂–Ω–æ)

–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ **–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ** - Redis –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ. –ü—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏:
- –û—á–µ–Ω—å –Ω–∏–∑–∫–æ–π –ø–∞–º—è—Ç–∏ –Ω–∞ —Ö–æ—Å—Ç–µ
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö (background save)
- –†–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –Ω–∞ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–µ—Ä

–î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤ —ç—Ç–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –º–æ–∂–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å.

### 2. Privileged mode (–ù–ï —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ï—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ö–æ—Å—Ç—É, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å privileged mode (–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ):

```yaml
redis:
  privileged: true
```

**‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:** Privileged mode –¥–∞—ë—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É root –ø—Ä–∞–≤–∞ –Ω–∞ —Ö–æ—Å—Ç–µ - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –≤ –∫—Ä–∞–π–Ω–µ–º —Å–ª—É—á–∞–µ!

### 3. –£–≤–µ–ª–∏—á–∏—Ç—å maxmemory –∏–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å appendonly (–ù–ï —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ú–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Redis, –Ω–æ —ç—Ç–æ –Ω–µ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–∏—Å—Ç–µ–º—ã.

## üìù –ü—Ä–æ–≤–µ—Ä–∫–∞:

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ —Ö–æ—Å—Ç–µ:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
sysctl vm.overcommit_memory

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Redis
docker compose restart redis

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker compose logs redis | grep -i warning
```

–ï—Å–ª–∏ warning –∏—Å—á–µ–∑ - –ø—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞! ‚úÖ
